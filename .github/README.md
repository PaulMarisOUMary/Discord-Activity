# Discord Activity

[!NOTE]
> Docker is **not mandatory** to run the project, and is provided as an optional convenience, offering a simpler and quicker way to run the project. Otherwise, refer to the [alternative setup section](#Alternative-Setup).

## Setup

1. **Environment Variables**: Create a `.env` file in the root directory with the following content:
    ```dotenv
    VITE_DISCORD_CLIENT_ID=00000000000000000000
    DISCORD_CLIENT_SECRET=XXXXXXXXXXXXXXXXXXXX-XXXXXXXXXX
    ```

2. **Run the Server & Client with Docker**: Utilize Docker Compose to build and run both the server and the client:
    ```bash
    docker compose up -d --build
    ```
    This command builds and starts the containers defined in the Docker Compose configuration file.

> [!TIP]  
> Use `docker compose down` to remove the Docker containers and networks created.

3. **Create Tunnel**: Use `cloudflared` to create a tunnel for local development. Run the following command:
    ```bash
    cloudflared tunnel --url http://localhost:8080
    ```

    - **Keep Tunnel Running**: If you close the terminal or stop `cloudflared`, the tunnel will be terminated, and you'll need to recreate it when you resume development.
    
    - **Access URL**: After successfully creating the tunnel, `cloudflared` will provide you with a publicly accessible URL (usually in the format `https://your-subdomain.trycloudflare.com`). Save this URL for step 4.

4. **Update Discord Developer Portal URL Mappings**:

    - **Update Activity URL Mappings**: Change the `TARGET` URL for the following `ROOT MAPPING`: `/` with the URL generated by `cloudflared`.

5. **Login to a Vocal Channel and Start Activity**: Now that everything is set up, you're ready to try out your new activity !

## Development

> [!IMPORTANT]
> For comprehensive development instructions regarding the **client**, please consult the dedicated [client/README.md](/client/README.md).

## Alternative Setup:

If you prefer not to use Docker, you can set up the project manually following these steps.

1. **Environment Variables**: Create a `.env` file in the root directory with the following content:
    ```dotenv
    VITE_DISCORD_CLIENT_ID=00000000000000000000
    DISCORD_CLIENT_SECRET=XXXXXXXXXXXXXXXXXXXX-XXXXXXXXXX
    ```

2. **Run the Server**: Make sure you are inside the `./server` directory.
```bash
npm run dev
```

3. **Run the Server**: Make sure you are inside the `./client` directory.
```bash
npm run dev
```
Or using Discord SDK
```bash
npm run dev:sdk
```

4. **Create Tunnel**: Use `cloudflared` to create a tunnel for local development. Run the following command:
    ```bash
    cloudflared tunnel --url http://localhost:8080
    ```
    Save the access URL for the next step.

5. **Update Discord Developer Portal URL Mappings**:

    - **Update Activity URL Mappings**: Change the `TARGET` URL for the following `ROOT MAPPING`: `/` with the URL generated by `cloudflared`.

6. **Test the app**: Now that everything is set up, you're ready to try out your new activity !
    Open the client: [http://localhost:5173/](http://localhost:5173/)<br />
    Or<br />
    Connect to a Vocal Channel and Start your Activity